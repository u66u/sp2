# Define the string constant for the format string.
data $format_str = { b "%d ", b 0 }

# Define the function to generate a random number using LCG.
export function w $rand(w %seed) {
@start
        # LCG parameters: a = 1103515245, c = 12345, m = 2^31
        %a =w copy 1103515245
        %c =w copy 12345
        %m =w copy 2147483648  # 2^31

        %seed1 =w mul %seed, %a
        %seed2 =w add %seed1, %c
        %seed3 =w urem %seed2, %m

        ret %seed3
}

# Define the function to print the matrix.
export function $print_matrix(l %matrix) {
@start
        %i =w copy 0
@loop_outer
        %j =w copy 0
@loop_inner
        %index =w mul %i, 10
        %index =w add %index, %j
        %index_l =l copy %index  # Copy to long
        %addr =l add %matrix, %index_l
        %val =w loadw %addr

        # Print the value
        %r =w call $printf(l $format_str, w %val)

        %j =w add %j, 1
        jnz %j, @loop_inner, @loop_outer_end
@loop_outer_end
        %i =w add %i, 1
        jnz %i, @loop_outer, @end
@end
        ret
}

# Define the main function to generate and print the matrix.
export function w $main() {
@start
        # Allocate memory for the 10x10 matrix (100 words)
        %matrix =l alloc4 400  # 100 * 4 bytes

        %seed =w copy 1  # Initial seed for the random number generator
        %i =w copy 0
@loop_fill
        %j =w copy 0
@loop_fill_inner
        %index =w mul %i, 10
        %index =w add %index, %j
        %index_l =l copy %index  # Copy to long
        %addr =l add %matrix, %index_l

        # Generate a random number
        %seed =w call $rand(w %seed)

        # Store the random number in the matrix
        storew %seed, %addr

        %j =w add %j, 1
        jnz %j, @loop_fill_inner, @loop_fill_end
@loop_fill_end
        %i =w add %i, 1
        jnz %i, @loop_fill, @print
@print
        # Print the matrix
        call $print_matrix(l %matrix)

        ret 0
}